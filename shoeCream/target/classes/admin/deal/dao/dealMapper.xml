<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
 PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 
<mapper namespace="dealSQL">
	<!-- 전체 목록 -->
	<select id="getDealList" parameterType="java.util.Map" resultType="deal">

		SELECT * FROM
		    (SELECT ROWNUM rn, d.* FROM
		        (SELECT d.dealId, d.purchaseId, d.salesId, d.checkId, d.deliveryId, d.regDate AS dealRegDate,
		                pur.userId AS purchaseUserId, pur.productId AS purchaseProductId, pur.status, pur.regDate AS purchaseRegDate, pur.regDate+30 AS purchaseDueDate,
		                s.userId AS salesUserId, s.productId AS salesProductId, s.price AS salesPrice, s.status AS salesStatus, s.regDate AS salesRegDate, s.regDate+30 AS salesDueDate,
		                p.productName, p.modelId, p.releasePrice, p.img1, p.img2, p.img3, p.releaseDate, p.brandName, p.productSize, p.productCollection, p.regDate AS productRegDate,
                        c.productId AS checkProductId, c.userId AS checkUserId, c.checkState, c.checkResult,
                        d2.trackingNum, d2.regDate AS deliveryRegDate
		        FROM deal_table d,
		             purchase_table pur,
		             sales_table s,
		             product_table p,
                     check_table c,
		             delivery_table d2
		             --address_table a
		        WHERE d.purchaseId = pur.purchaseId
		              and d.salesId = s.salesId
		              and s.productId = p.productId
		              and d.checkId = c.checkId
		              and d.deliveryId = d2.deliveryId
		              --and o.addressId = a.addressId
		        ORDER BY dealId desc)d)
		WHERE rn BETWEEN #{startNum} AND #{endNum}
	</select>
	
	<!-- 한개 가져오기 -->
	<select id="getDeal" parameterType="int" resultType="deal">
		SELECT * FROM order_table WHERE orderId = #{orderId}
	</select>
	
	<!-- 총글수 -->
	<select id="getTotalCount" resultType="int">
		SELECT count(*) FROM order_table
	</select>
	
	<!-- 검색 -->
	<select id="getDealSearchList" parameterType="java.util.Map" resultType="deal">
		
		SELECT * FROM
		    (SELECT ROWNUM rn, d.* FROM
		        (SELECT d.dealId, d.purchaseId, d.salesId, d.checkId, d.deliveryId, d.regDate AS dealRegDate,
		                pur.userId AS purchaseUserId, pur.productId AS purchaseProductId, pur.status, pur.regDate AS purchaseRegDate, pur.regDate+30 AS purchaseDueDate,
		                s.userId AS salesUserId, s.productId AS salesProductId, s.price AS salesPrice, s.status AS salesStatus, s.regDate AS salesRegDate, s.regDate+30 AS salesDueDate,
		                p.productName, p.modelId, p.releasePrice, p.img1, p.img2, p.img3, p.releaseDate, p.brandName, p.productSize, p.productCollection, p.regDate AS productRegDate,
                        c.productId AS checkProductId, c.userId AS checkUserId, c.checkState, c.checkResult,
                        d2.trackingNum, d2.regDate AS deliveryRegDate
		        FROM deal_table d,
		             purchase_table pur,
		             sales_table s,
		             product_table p,
                     check_table c,
		             delivery_table d2
		             --address_table a
		        WHERE d.purchaseId = pur.purchaseId
		              and d.salesId = s.salesId
		              and s.productId = p.productId
		              and d.checkId = c.checkId
		              and d.deliveryId = d2.deliveryId
		              --and o.addressId = a.addressId
		        ORDER BY dealId desc)d
			WHERE ${searchOption} LIKE '%' || #{keyword} || '%')
		WHERE rn BETWEEN #{startNum} AND #{endNum}
	</select>
	
</mapper>