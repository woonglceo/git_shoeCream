<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
 PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="mypageSQL">
	<!-- 특정 회원의 wish_list 불러오기 -->
	<select id="getWishList" parameterType="java.util.Map" resultType="WishListDTO">
		select * 
			from (select rownum rn, totalData.* 
				from (select * from wish_list where userId=#{userId} order by wishlistId desc) totalData) 
		where rn between #{startNum} and #{endNum}
	</select>
	
	<!-- 특정 테이블 전체 데이터 수 -->
	<select id="getTotalDB" parameterType="java.util.Map" resultType="Integer">
		select count(*) from ${tableName} where userId=#{userId}
	</select>
	
	<!-- wish 상품 삭제 -->
	<delete id="deleteWish" parameterType="Integer">
		delete from wish_list where wishListId=#{wishListId}
	</delete>
	
	<!-- 특정 회원의 구매내역 불러오기 -->
	<select id="getBuyList" parameterType="java.util.Map" resultType="PurchaseDTO">
		select * 
			from (select rownum rn, totalData.* 
				from (select * from purchase_table where userId=#{userId} order by purchaseId desc) totalData) 
		where rn between #{startNum} and #{endNum}
	</select>
	
	<!-- 리스트를 가져오기 전 마감기한 업데이트 -->
	<update id="updateStaus" parameterType="java.util.Date">
	<![CDATA[
		update purchase_table set status=1 where regDate <= #{today}
	]]>
	</update>
	
	<!-- 구매가를 위한 판매테이블 불러오기 -->
	<select id="getPrice" parameterType="Integer" resultType="SalesDTO">
		select * from sales_table where productId=#{productId}
	</select>
	
	<!-- 특정회원의 총 거래 개수 구하기 -->
	<select id="getTotalBuying" parameterType="Integer" resultType="Integer">
		select count(*) from purchase_table where userId=#{userId}
	</select>
	
	<!-- 특정회원의 진행중인 거래 개수 구하기 -->
	<select id="getIngBuying" parameterType="Integer" resultType="Integer">
		select count(*) from purchase_table where userId=#{userId} and status = 0
	</select>
	
	<!-- 특정회원의 종료된 거래 개수 구하기 -->
	<select id="getEndBuying" parameterType="Integer" resultType="Integer">
		select count(*) from purchase_table where userId=#{userId} and status = 1
	</select>
</mapper>